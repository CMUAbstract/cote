// test-number.cpp
// Number class test
//
// Written by Bradley Denby
// Other contributors: None
//
// See the top-level LICENSE file for the license.

// Standard library
#include <cstddef>       // size_t
#include <cstdlib>       // exit, EXIT_SUCCESS
#include <filesystem>    // path, directory_iterator
#include <iostream>      // cout
#include <ostream>       // endl

// json library
#include <Number.hpp>    // Number
#include <utilities.hpp> // readFile, writeFile
#include <Value.hpp>     // Value

int main(int argc, char** argv) {
  // Variables
  std::filesystem::path odir;
  // Initialize test objects
  if(argc!=3) {
    std::cout << "Usage: " << argv[0]
              << " /path/to/idir/"
              << " /path/to/odir/"
              << std::endl;
    std::exit(EXIT_SUCCESS);
  } else {
    std::filesystem::path idir(argv[1]);
    std::filesystem::directory_iterator it(idir);
    while(it!=std::filesystem::end(it)) {
      std::string pathStr = it->path().string();
      it++;
    }
    // Output directory
    odir = std::filesystem::path(argv[2]);
  }
  // Perform tests
  std::cout << "Testing..."
            << std::endl;
  std::vector<std::string> numbers = {
   "0", "0E0", "0E10", "0E+0", "0E+10", "0E-0", "0E-10", "0e0", "0e10", "0e+0",
   "0e+10", "0e-0", "0e-10", "0.0", "0.0E0", "0.0E10", "0.0E+0", "0.0E+10",
   "0.0E-0", "0.0E-10", "0.0e0", "0.0e10", "0.0e+0", "0.0e+10", "0.0e-0",
   "0.0e-10", "0.10", "0.10E0", "0.10E10", "0.10E+0", "0.10E+10", "0.10E-0",
   "0.10E-10", "0.10e0", "0.10e10", "0.10e+0", "0.10e+10", "0.10e-0",
   "0.10e-10", "10", "10E0", "10E10", "10E+0", "10E+10", "10E-0", "10E-10",
   "10e0", "10e10", "10e+0", "10e+10", "10e-0", "10e-10", "10.0", "10.0E0",
   "10.0E10", "10.0E+0", "10.0E+10", "10.0E-0", "10.0E-10", "10.0e0", "10.0e10",
   "10.0e+0", "10.0e+10", "10.0e-0", "10.0e-10", "10.10", "10.10E0", "10.10E10",
   "10.10E+0", "10.10E+10", "10.10E-0", "10.10E-10", "10.10e0", "10.10e10",
   "10.10e+0", "10.10e+10", "10.10e-0", "10.10e-10", "-0", "-0E0", "-0E10",
   "-0E+0", "-0E+10", "-0E-0", "-0E-10", "-0e0", "-0e10", "-0e+0", "-0e+10",
   "-0e-0", "-0e-10", "-0.0", "-0.0E0", "-0.0E10", "-0.0E+0", "-0.0E+10",
   "-0.0E-0", "-0.0E-10", "-0.0e0", "-0.0e10", "-0.0e+0", "-0.0e+10", "-0.0e-0",
   "-0.0e-10", "-0.10", "-0.10E0", "-0.10E10", "-0.10E+0", "-0.10E+10",
   "-0.10E-0", "-0.10E-10", "-0.10e0", "-0.10e10", "-0.10e+0", "-0.10e+10",
   "-0.10e-0", "-0.10e-10", "-10", "-10E0", "-10E10", "-10E+0", "-10E+10",
   "-10E-0", "-10E-10", "-10e0", "-10e10", "-10e+0", "-10e+10", "-10e-0",
   "-10e-10", "-10.0", "-10.0E0", "-10.0E10", "-10.0E+0", "-10.0E+10",
   "-10.0E-0", "-10.0E-10", "-10.0e0", "-10.0e10", "-10.0e+0", "-10.0e+10",
   "-10.0e-0", "-10.0e-10", "-10.10", "-10.10E0", "-10.10E10", "-10.10E+0",
   "-10.10E+10", "-10.10E-0", "-10.10E-10", "-10.10e0", "-10.10e10",
   "-10.10e+0", "-10.10e+10", "-10.10e-0", "-10.10e-10"
  };
  std::vector<double> doubles = {
   0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
   0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.1,
   1000000000.0, 0.1, 1000000000.0, 0.1, 1e-11, 0.1, 1000000000.0, 0.1,
   1000000000.0, 0.1, 1e-11, 10.0, 10.0, 100000000000.0, 10.0, 100000000000.0,
   10.0, 1e-09, 10.0, 100000000000.0, 10.0, 100000000000.0, 10.0, 1e-09, 10.0,
   10.0, 100000000000.0, 10.0, 100000000000.0, 10.0, 1e-09, 10.0,
   100000000000.0, 10.0, 100000000000.0, 10.0, 1e-09, 10.1, 10.1,
   101000000000.0, 10.1, 101000000000.0, 10.1, 1.01e-09, 10.1, 101000000000.0,
   10.1, 101000000000.0, 10.1, 1.01e-09, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0,
   -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0,
   -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.1, -0.1, -1000000000.0, -0.1,
   -1000000000.0, -0.1, -1e-11, -0.1, -1000000000.0, -0.1, -1000000000.0, -0.1,
   -1e-11, -10.0, -10.0, -100000000000.0, -10.0, -100000000000.0, -10.0, -1e-09,
   -10.0, -100000000000.0, -10.0, -100000000000.0, -10.0, -1e-09, -10.0, -10.0,
   -100000000000.0, -10.0, -100000000000.0, -10.0, -1e-09, -10.0,
   -100000000000.0, -10.0, -100000000000.0, -10.0, -1e-09, -10.1, -10.1,
   -101000000000.0, -10.1, -101000000000.0, -10.1, -1.01e-09, -10.1,
   -101000000000.0, -10.1, -101000000000.0, -10.1, -1.01e-09
  };
  bool parseNumberPass = true;
  for(std::size_t i=0; i<156; i++) {
    std::string malleableNumberString(numbers.at(i));
    json::Number number(malleableNumberString);
    double dbl = number.getValue();
    parseNumberPass = (parseNumberPass && (dbl==doubles.at(i)));
  }
  std::cout << "  " << (parseNumberPass ? "PASS" : "FAIL")
            << std::endl;
  // Clean up
  std::exit(EXIT_SUCCESS);
}
